# 🎨 SpiceDB Permission Trace HTML Examples

Interactive HTML visualizations of SpiceDB permission traces generated by the `zed` CLI tool.

## 🚀 Quick Start

Open **`index.html`** in your browser to view all examples, or jump directly to individual files below.

---

## 📂 Example Files

### Example 1: Simple Has Permission ✅

**File**: `example1_simple_has_permission.html`

Basic permission check that succeeds with clean visualization.

- **Scenario**: `document:report-2024` → `view` → `user:alice`
- **Result**: ✓ Has Permission (green icon)
- **Features**: Metadata header, subject display, duration tracking

### Example 2: No Permission ⨉

**File**: `example2_no_permission.html`

Permission denied with faint styling to de-emphasize the failure.

- **Scenario**: `document:secret-plans` → `admin` → `user:bob`
- **Result**: ⨉ No Permission (red icon)
- **Features**: Red icon, faint text, clear denial indicator

### Example 3: Nested with Cache 🏎️

**File**: `example3_nested_with_cache.html`

Hierarchical permission resolution showing cache optimization.

- **Scenario**: `document:quarterly-report` → `folder:documents` (cached)
- **Result**: ✓ Has Permission with cache badge
- **Features**: Expandable tree, "cached by spicedb" badge, relation color coding

### Example 4: Conditional with Caveat ✅?

**File**: `example4_conditional_with_caveat.html`

Permission granted after evaluating a caveat expression.

- **Scenario**: `document:internal-roadmap` with `engineering_clearance` caveat
- **Expression**: `department == "engineering" && clearance_level >= 3`
- **Context**: JSON showing `{"department": "engineering", "clearance_level": 3}`
- **Features**: Caveat evaluation, expression display, pretty-printed JSON context

### Example 5: Missing Context ?

**File**: `example5_missing_context.html`

Permission check requires context that wasn't provided.

- **Scenario**: `document:sensitive-data` with `secure_access` caveat
- **Missing**: `ip_address`, `mfa_verified`
- **Features**: Purple ? icon, list of missing required fields

### Example 6: Complex Hierarchy 🌳

**File**: `example6_complex_hierarchy.html`

Deep nested permission resolution across multiple resource types.

- **Scenario**: `repository:backend-api` → `organization:acme-corp` → `group:engineering` → `user:alice`
- **Features**: 3-level nesting, mixed permission types, hierarchical visualization

### Example 7: Bulk Mixed Results 📊

**File**: `example7_bulk_mixed_results.html`

Multiple permission checks with different outcomes in one report.

- **Checks**: 3 checks (✓ has permission, ⨉ no permission, ? missing context)
- **Features**: Visual separators, check numbering, shared metadata header

---

## 🎨 Visual Features

### Icons & Color Coding

| Icon | Meaning | Color | CSS Class |
|------|---------|-------|-----------|
| ✓ | Has Permission | Green (#4ec9b0) | `.icon.has-permission` |
| ⨉ | No Permission | Red (#f48771) | `.icon.no-permission` |
| ? | Conditional/Missing Context | Purple (#c586c0) | `.icon.conditional` |
| ! | Cycle Detected | Orange (#ce9178) | `.icon.cycle` |
| ∵ | Unspecified | Yellow (#dcdcaa) | `.icon.unspecified` |

### Permission Types

- **Permissions** (green): `view`, `edit`, `admin`, `push`
- **Relations** (orange): `member`, `viewer`, `owner`

### Badges

- **cached by spicedb** (blue) - Result from SpiceDB dispatch cache
- **cached by materialize** (purple) - Result from materialized view
- **cycle** (orange) - Circular dependency detected

---

## 🌓 Dark/Light Mode

All examples support **automatic theme switching** based on your system preference:

- **Dark Mode** (default): VS Code Dark+ theme
- **Light Mode**: High-contrast light theme for printing

Change your system theme and refresh the page to see the difference!

---

## 🧪 Interactive Features

### Click to Expand/Collapse

- Click any **▶** arrow to expand nested traces
- Click again (or **▼**) to collapse
- All nodes open by default for easy viewing
- Smooth rotation animation

### Hover Effects

- Nodes subtly highlight on hover
- Smooth 0.2s transitions
- Cursor changes to pointer on interactive elements

### Keyboard Navigation

- **Tab** through interactive elements
- **Enter/Space** to expand/collapse
- **ARIA labels** for screen readers
- Full keyboard accessibility

---

## 📐 Technical Details

### Architecture

- **Zero dependencies**: Self-contained HTML files
- **No JavaScript**: Pure HTML/CSS using native `<details>` elements
- **Embedded CSS**: ~5KB stylesheet included inline
- **File sizes**: 6.9KB - 7.9KB per trace

### Performance

- **Render time**: <100ms for typical trace
- **Load time**: <50ms (no external resources)
- **Memory**: ~512KB per renderer instance (pooled)
- **Pre-allocation**: 8KB capacity hint per trace, 1MB cap for bulk operations

### Security

- **XSS protection**: All user strings escaped with `html.EscapeString()`
- **DoS protection**: Metadata capped at 1024 runes, recursion limited to 100 levels
- **UTF-8 safe**: Rune-aware truncation prevents boundary panics

### Accessibility

- **Semantic HTML5**: Proper use of `<details>`, `<summary>`, `<code>` tags
- **ARIA labels**: Descriptive labels on all interactive elements
- **Keyboard navigable**: Tab, Enter, Space all work as expected
- **Screen reader friendly**: Proper heading hierarchy and roles

### Browser Support

- Chrome/Edge 90+ ✅
- Firefox 88+ ✅
- Safari 14+ ✅
- All modern browsers with `<details>` element support (2020+)

---

## 🚀 Generating Your Own

### Single Trace

```bash
zed permission check document:report-2024 view user:alice \
  --explain \
  --output=trace.html
```

### Bulk Checks

```bash
zed permission check-bulk --explain --output=bulk.html < checks.jsonl
```

### With Custom Metadata

```bash
zed permission check document:doc1 view user:alice \
  --explain \
  --output=trace.html \
  --server=grpc.authzed.com:443 \
  --version=v1.35.0
```

---

## 🔍 Implementation Details

### Caveat Evaluation

- **Expression display**: CEL expressions shown in italic
- **Caveat name**: Purple bold text
- **Context**: Pretty-printed JSON in monospace font
- **Result indicators**: ✓ (true), ⨉ (false), ? (missing context)

### Bulk Check Support

- **Visual separators**: 2px solid line between checks with 30px margin
- **Check numbering**: "Check #1", "Check #2", etc.
- **Shared metadata**: Single header for all checks (efficient rendering)

### Tree Structure

- **Expandable nodes**: `<details>` with `<summary>` for interaction
- **Leaf nodes**: Simple `<div>` (end of permission chain)
- **Indentation**: Visual hierarchy with connecting lines
- **Gap spacing**: 8px between elements for readability

### Theme Colors (Dark Mode)

```css
--bg-primary: #1e1e1e      /* Body background */
--bg-secondary: #252526    /* Tree container */
--bg-tertiary: #2d2d30     /* Header, hover states */
--text-primary: #d4d4d4    /* Main text */
--text-faint: #858585      /* Dimmed text */
--success: #4ec9b0         /* Has permission */
--error: #f48771           /* No permission */
--conditional: #c586c0     /* Missing context */
--cycle: #ce9178           /* Cycles */
```

---

## 🧪 Testing Coverage

All examples are validated with comprehensive test coverage:

- ✅ Has permission rendering
- ✅ No permission rendering
- ✅ Conditional permission with caveat
- ✅ Missing context handling
- ✅ Cycle detection
- ✅ Bulk check rendering (1000+ traces)
- ✅ XSS protection (script tag injection)
- ✅ UTF-8 truncation safety
- ✅ Pool lifecycle (no memory leaks)
- ✅ Metadata rendering
- ✅ Subject with relation
- ✅ Nil resource handling
- ✅ Deep nesting (100 levels)

---

## 🎯 Use Cases

1. **Debugging**: Understand why a permission check failed or succeeded
2. **Documentation**: Share permission resolution details with your team
3. **Audit Trails**: Save HTML reports for compliance and security audits
4. **Testing**: Visual regression testing for permission logic changes
5. **Education**: Teach SpiceDB concepts with interactive visual examples
6. **Demos**: Beautiful examples for presentations and blog posts

---

## 🎁 Bonus Features

### Copy-Paste Friendly

- Self-contained HTML files (no external dependencies)
- Can be emailed or shared directly
- Work offline

### Print Support

- Automatically switches to light theme for printing
- Clear black/white output
- No background colors to waste ink

### Mobile Responsive

- Viewport meta tag for proper scaling
- Flexible layout adapts to screen size
- Touch-friendly expand/collapse

### No JavaScript Required

- Native `<details>` elements for expand/collapse
- Pure CSS animations
- Works even with JavaScript disabled

---

## 📖 Legend

Each HTML file includes an interactive legend at the bottom explaining:

- Icon meanings (✓ ⨉ ? ! ∵)
- Color coding (permissions vs relations)
- Badge types (cache, cycle)

---

**Generated by**: `zed` CLI tool
**Renderer**: HTML trace visualizer with embedded CSS
**Last Updated**: 2025-10-21
